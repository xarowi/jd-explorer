/*
мы едем, едем, на зависть раме!
на зависть раме мы летом едем в крым с worte!
*/var sessionId,currentPath="/",objectLimit=50,loadedObjects=[],rightNowIsWhiteMode=!0,savedDirectories={};async function createSession(){var e=await fetch("/api/v2/sessions",{method:"PUT"}),t=await e.json();sessionId=t.sessionId}async function loadDirFile(e,t){if(savedDirectories.hasOwnProperty(currentPath)){var n=savedDirectories[currentPath];if(n.skip===e&&n.generateContentAuthorization===t)return loadedObjects=n.loadedObjects,n.hasMore}var a=await fetch(`/api/v2/objects/check-directory?path=${currentPath}&skip=${e}&limit=${objectLimit}&generateContentAuthorization=${t?"True":"False"}`,{headers:{"x-session-id":sessionId}}),i=await a.json();return loadedObjects=e>0?(new Array).concat(loadedObjects,i.objects):i.objects,savedDirectories[currentPath]={loadedObjects:JSON.parse(JSON.stringify(loadedObjects)),hasMore:i.hasMore,skip:e,generateContentAuthorization:t},i.hasMore}function goToFile(e){e.url.startsWith("/private/")?!e.authorizedUrl||e.cannotGenerateLink?alertMessage("Website can't generate url. Very sorry! :(","danger",document.getElementById("live-alert")):window.open(e.authorizedUrl,"_blank").focus():window.open("https://jd-s3.akamaized.net"+e.url,"_blank").focus()}function generateFileList(e){var t=document.createDocumentFragment();if("/"!=currentPath){var n=createLi("🔙 Back");n.addEventListener("click",(async function(){var e=currentPath.split("/"),t=currentPath.replace(e[e.length-2],"");t=t.substring(0,t.length-1),currentPath=t;var n=document.getElementById("file-list");n.innerHTML="",n.appendChild(createSpinner());var a=generateFileList(await loadDirFile(0,!0));n.innerHTML="",n.appendChild(a)})),t.appendChild(n)}if(loadedObjects.map((function(e){var n=createLi(getEmojiByFile(e)+" "+e.name);"folder"==e.type?n.addEventListener("click",(function(){goToThisPath(e.url)})):n.addEventListener("click",(function(){goToFile(e)})),t.appendChild(n)})),e){var a=createLi("⚓ Get more items");a.addEventListener("click",(async function(){var e=document.getElementById("file-list");e.innerHTML="",e.appendChild(createSpinner());var t=generateFileList(await loadDirFile(loadedObjects.length,!0));e.innerHTML="",e.appendChild(t)})),t.appendChild(a)}return t}async function goToThisPath(e){var t=document.getElementById("file-list");document.getElementById("path-value").value=e,currentPath=e,t.innerHTML="",t.appendChild(createSpinner());var n=generateFileList(await loadDirFile(0,!0));t.innerHTML="",t.appendChild(n)}document.getElementById("go-to-this-path").addEventListener("click",(function(){goToThisPath(document.getElementById("path-value").value)})),document.getElementById("change-theme").addEventListener("click",(function(){rightNowIsWhiteMode?(document.getElementById("change-theme").innerHTML="Change to white theme",document.getElementById("body-html").classList.add("bg-dark"),document.getElementById("body-html").classList.add("text-white"),document.getElementById("list-card").classList.add("bg-dark"),document.getElementById("list-card").classList.add("text-white"),rightNowIsWhiteMode=!1):(document.getElementById("change-theme").innerHTML="Change to dark theme",document.getElementById("body-html").classList.remove("bg-dark"),document.getElementById("body-html").classList.remove("text-white"),document.getElementById("list-card").classList.remove("bg-dark"),document.getElementById("list-card").classList.remove("text-white"),rightNowIsWhiteMode=!0)})),setInterval((async function(){await fetch("/api/v2/ping",{headers:{"x-session-id":sessionId}})}),5e3),createSession().then((()=>goToThisPath(currentPath)));